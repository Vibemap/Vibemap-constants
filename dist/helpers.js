"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Axios=require("axios"),axiosRetry=require("axios-retry"),querystring=require("querystring"),dayjs=require("dayjs"),dayjsRecur=require("dayjs-recur"),isBetween=require("dayjs/plugin/isBetween"),LinearScale=require("linear-scale"),truncate=require("truncate"),turf=require("@turf/helpers"),turf_distance=require("@turf/distance"),turf_boolean=require("@turf/boolean-point-in-polygon"),constants=require("./constants.js"),map=require("./map.js"),vibes=require("./vibes.js"),wordpress=require("./wordpress.js");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function _interopNamespace(t){if(t&&t.__esModule)return t;var o=Object.create(null);return t&&Object.keys(t).forEach(function(e){var a;"default"!==e&&(a=Object.getOwnPropertyDescriptor(t,e),Object.defineProperty(o,e,a.get?a:{enumerable:!0,get:function(){return t[e]}}))}),o.default=t,Object.freeze(o)}require("@mapbox/geo-viewport"),require("@turf/meta"),require("@turf/clusters"),require("@turf/bbox-polygon"),require("@turf/center"),require("@turf/truncate"),require("@turf/clusters-dbscan"),require("@turf/points-within-polygon"),require("@turf/rhumb-bearing"),require("@turf/rhumb-distance"),require("@turf/rhumb-destination"),require("fuse.js");var Axios__default=_interopDefaultLegacy(Axios),axiosRetry__default=_interopDefaultLegacy(axiosRetry),querystring__default=_interopDefaultLegacy(querystring),dayjs__default=_interopDefaultLegacy(dayjs),dayjsRecur__default=_interopDefaultLegacy(dayjsRecur),isBetween__default=_interopDefaultLegacy(isBetween),LinearScale__default=_interopDefaultLegacy(LinearScale),truncate__default=_interopDefaultLegacy(truncate),turf__namespace=_interopNamespace(turf),turf_distance__default=_interopDefaultLegacy(turf_distance),turf_boolean__default=_interopDefaultLegacy(turf_boolean),cities=[{id:56490,slug:"berkeley",type:"official",location:{latitude:37.8715226,longitude:-122.273042},centerpoint:[-122.273042,37.8715226],mailchimp_id:"",radius:12,name:"Berkeley"},{id:56488,slug:"alameda",type:"early",location:{latitude:37.7798721,longitude:-122.2821855},centerpoint:[-122.2821855,37.7798721],mailchimp_id:"",radius:12,name:"Alameda"},{id:55524,slug:"san-jose",type:"early",location:{latitude:37.33874,longitude:-121.8852525},centerpoint:[-121.8852525,37.33874],mailchimp_id:"ef90288b3c",radius:15,name:"San Jose"},{id:55522,slug:"dallas",type:"early",location:{latitude:32.7766642,longitude:-96.79698789999999},centerpoint:[-96.79698789999999,32.7766642],mailchimp_id:"f0de27e219",radius:10,name:"Dallas"},{id:55517,slug:"norfolk",type:"early",location:{latitude:36.8507689,longitude:-76.28587259999999},centerpoint:[-76.28587259999999,36.8507689],mailchimp_id:"",radius:10,name:"Norfolk"},{id:53994,slug:"ciudad-de-mexico",type:"early",location:{latitude:19.4326077,longitude:-99.133208},centerpoint:[-99.133208,19.4326077],mailchimp_id:"518242369a",radius:15,name:"Mexico City"},{id:52306,slug:"peoria",type:"early",location:{latitude:40.6936488,longitude:-89.5889864},centerpoint:[-89.5889864,40.6936488],mailchimp_id:"58578fcae6",radius:10,name:"Peoria"},{id:51835,slug:"toronto",type:"official",location:{latitude:43.653226,longitude:-79.3831843},centerpoint:[-79.3831843,43.653226],mailchimp_id:"95135b1969",radius:20,name:"Toronto"},{id:45678,slug:"houston",type:"official",location:{latitude:29.760314934412516,longitude:-95.36962040978698},centerpoint:[-95.36962040978698,29.760314934412516],mailchimp_id:"ea2fe099f2",radius:30,name:"Houston"},{id:44901,slug:"puerto-vallarta",type:"early",location:{latitude:20.615046993637947,longitude:-105.231817181398},centerpoint:[-105.231817181398,20.615046993637947],mailchimp_id:"57c905a1df",radius:4,name:"Puerto Vallarta"},{id:38387,slug:"austin",type:"early",location:{latitude:30.267153,longitude:-97.7430608},centerpoint:[-97.7430608,30.267153],mailchimp_id:"1d933c234f",radius:20,name:"Austin"},{id:38380,slug:"denver",type:"official",location:{latitude:39.7392358,longitude:-104.990251},centerpoint:[-104.990251,39.7392358],mailchimp_id:"b576abf895",radius:20,name:"Denver"},{id:38148,slug:"chicago",type:"official",location:{latitude:41.8781136,longitude:-87.6297982},centerpoint:[-87.6297982,41.8781136],mailchimp_id:"b865b3ef72",radius:20,name:"Chicago"},{id:38143,slug:"new-york",type:"official",location:{latitude:40.7127610684055,longitude:-74.0060103509262},centerpoint:[-74.0060103509262,40.7127610684055],mailchimp_id:"56ebd9923f",radius:20,name:"New York"},{id:38137,slug:"san-diego",type:"official",location:{latitude:32.715738,longitude:-117.1610838},centerpoint:[-117.1610838,32.715738],mailchimp_id:"7fb6e2a465",radius:20,name:"San Diego"},{id:38119,slug:"los-angeles",type:"official",location:{latitude:34.04734503476973,longitude:-118.25308336038819},centerpoint:[-118.25308336038819,34.04734503476973],mailchimp_id:"7fb6e2a465",radius:30,name:"Los Angeles"},{id:1450,slug:"guadalajara",type:"official",location:{latitude:20.65969879999999,longitude:-103.3496092},centerpoint:[-103.3496092,20.65969879999999],mailchimp_id:"0154de5655",radius:10,name:"Guadalajara"},{id:1447,slug:"oakland",type:"official",location:{latitude:37.79831556913852,longitude:-122.25940509567872},centerpoint:[-122.25940509567872,37.79831556913852],mailchimp_id:"da0894a0e6",radius:20,name:"Oakland"},{id:1444,slug:"san-francisco",type:"official",location:{latitude:37.7749295,longitude:-122.4194155},centerpoint:[-122.4194155,37.7749295],mailchimp_id:"f30df08e52",radius:5,name:"San Francisco"},{id:1441,slug:"portland",type:"official",location:{latitude:45.52342768785231,longitude:-122.67428398132324},centerpoint:[-122.67428398132324,45.52342768785231],mailchimp_id:"27c0467a17",radius:9,name:"Portland"},{id:1438,slug:"seattle",type:"official",location:{latitude:47.6062095,longitude:-122.3320708},centerpoint:[-122.3320708,47.6062095],mailchimp_id:"baadb78d87",radius:8,name:"Seattle"},{id:1435,slug:"vancouver",type:"official",location:{latitude:49.2827291,longitude:-123.1207375},centerpoint:[-123.1207375,49.2827291],mailchimp_id:"da30e0d7dc",radius:7,name:"Vancouver"}],neighborhoods=[{slug:"soma-west",vibe:[3021,7046,7657],map:{lat:37.776239666109525,lng:-122.4115724588135,zoom:15},radius:"0.3",name:"SOMA West",location:{latitude:37.776239666109525,longitude:-122.4115724588135,zoom:15}},{slug:"downtown-tampa",vibe:[],map:{lat:27.949447,lng:-82.4563199,zoom:14},radius:"0.3",name:"Downtown Tampa",location:{latitude:27.949447,longitude:-82.4563199,zoom:14}},{slug:"ybor-city",vibe:[],map:{lat:27.9645757,lng:-82.42595179999999,zoom:14},radius:"0.3",name:"Ybor City",location:{latitude:27.9645757,longitude:-82.42595179999999,zoom:14}},{slug:"westshore-tampa",vibe:[],map:{lat:27.970516796167992,lng:-82.51457542115496,zoom:14},radius:"2",name:"Westshore Tampa",location:{latitude:27.970516796167992,longitude:-82.51457542115496,zoom:14}},{slug:"downtown-evanston",vibe:[],map:{lat:42.04848216814751,lng:-87.68181749783933,zoom:15},radius:"0.5",name:"Downtown Evanston",location:{latitude:42.04848216814751,longitude:-87.68181749783933,zoom:15}},{slug:"east-village",vibe:[13115,3673,1073],map:{lat:40.7264773,lng:-73.98153370000001,zoom:14},radius:"0.3",name:"East Village",location:{latitude:40.7264773,longitude:-73.98153370000001,zoom:14}},{slug:"union-square",vibe:[],map:{lat:40.7358633,lng:-73.9910835,zoom:16},radius:"0.5",name:"Union Square",location:{latitude:40.7358633,longitude:-73.9910835,zoom:16}},{slug:"uptown",vibe:[1073,5690,5553],map:{lat:41.9665404,lng:-87.6533404,zoom:14},radius:"0.4",name:"Uptown",location:{latitude:41.9665404,longitude:-87.6533404,zoom:14}},{slug:"hyde-park",vibe:[2034,5553,5678],map:{lat:41.80546409999999,lng:-87.60876379999999,zoom:14},radius:"0.3",name:"Hyde Park",location:{latitude:41.80546409999999,longitude:-87.60876379999999,zoom:14}},{slug:"west-main-street",vibe:[4566,3021,2230],map:{lat:40.699765,lng:-89.61042189999999,zoom:14},radius:"0.8",name:"West Main Street",location:{latitude:40.699765,longitude:-89.61042189999999,zoom:14}},{slug:"peoria-riverfront",vibe:[6158,4111,3027],map:{lat:40.690670560304085,lng:-89.5862125132446,zoom:15},radius:"0.2",name:"Peoria RiverFront",location:{latitude:40.690670560304085,longitude:-89.5862125132446,zoom:15}},{slug:"warehouse-district",vibe:[6783,1073,2467],map:{lat:40.6848751,lng:-89.59690839999999,zoom:18},radius:"0.2",name:"Warehouse District",location:{latitude:40.6848751,longitude:-89.59690839999999,zoom:18}},{slug:"downtown-peoria",vibe:[1100,1073,1687,7744],map:{lat:40.6923123,lng:-89.59009139999999,zoom:14},radius:"0.6",name:"Downtown Peoria",location:{latitude:40.6923123,longitude:-89.59009139999999,zoom:14}},{slug:"the-loop",vibe:[1100,7424,8617],map:{lat:41.8786351,lng:-87.6250549,zoom:14},radius:"0.8",name:"The Loop",location:{latitude:41.8786351,longitude:-87.6250549,zoom:14}},{slug:"liberty-village",vibe:[6962,6549,6795],map:{lat:43.6373781,lng:-79.4211567,zoom:14},radius:"0.3",name:"Liberty Village",location:{latitude:43.6373781,longitude:-79.4211567,zoom:14}},{slug:"the-village",vibe:[5684,1064,6555],map:{lat:43.75808380000001,lng:-79.5707383,zoom:14},radius:"0.3",name:"The Village",location:{latitude:43.75808380000001,longitude:-79.5707383,zoom:14}},{slug:"high-park",vibe:[3024,1106,5514],map:{lat:43.64654789999999,lng:-79.4636903,zoom:14},radius:"0.3",name:"High Park",location:{latitude:43.64654789999999,longitude:-79.4636903,zoom:14}},{slug:"little-italy",vibe:[3005,7016,1414],map:{lat:43.6552194,lng:-79.41386039999999,zoom:14},radius:"0.3",name:"Little Italy",location:{latitude:43.6552194,longitude:-79.41386039999999,zoom:14}},{slug:"the-danforth",vibe:[6756,1060,6950],map:{lat:43.6837565,lng:-79.3212058,zoom:14},radius:"0.3",name:"The Danforth",location:{latitude:43.6837565,longitude:-79.3212058,zoom:14}},{slug:"st-lawrence-market",vibe:[3021,5567,1956],map:{lat:43.64868790000001,lng:-79.3715454,zoom:14},radius:"0.3",name:"St. Lawrence Market",location:{latitude:43.64868790000001,longitude:-79.3715454,zoom:14}},{slug:"the-junction",vibe:[4535,1782,2230],map:{lat:43.6655088,lng:-79.4721328,zoom:14},radius:"0.3",name:"The Junction",location:{latitude:43.6655088,longitude:-79.4721328,zoom:14}},{slug:"parkdale",vibe:[1701,6741,5638],map:{lat:43.643832,lng:-79.442534,zoom:14},radius:"0.3",name:"Parkdale",location:{latitude:43.643832,longitude:-79.442534,zoom:14}},{slug:"don-mills",vibe:[6801,1103,1109],map:{lat:43.7448473,lng:-79.34092299999999,zoom:14},radius:"0.3",name:"Don Mills",location:{latitude:43.7448473,longitude:-79.34092299999999,zoom:14}},{slug:"the-beaches",vibe:[4111,1903,5687],map:{lat:43.6673479,lng:-79.29669299999999,zoom:14},radius:"0.3",name:"The Beaches",location:{latitude:43.6673479,longitude:-79.29669299999999,zoom:14}},{slug:"riverdale",vibe:[7094,7115,6555],map:{lat:43.678985,lng:-79.34491009999999,zoom:14},radius:"0.3",name:"Riverdale",location:{latitude:43.678985,longitude:-79.34491009999999,zoom:14}},{slug:"cabbagetown",vibe:[5039,5690,2159],map:{lat:43.6658668,lng:-79.3686331,zoom:14},radius:"0.3",name:"Cabbagetown",location:{latitude:43.6658668,longitude:-79.3686331,zoom:14}},{slug:"summerhill",vibe:[6753,2464,1782],map:{lat:43.6822899,lng:-79.3907744,zoom:14},radius:"0.3",name:"Summerhill",location:{latitude:43.6822899,longitude:-79.3907744,zoom:14}},{slug:"rosedale",vibe:[1109,1067,1687],map:{lat:43.683375,lng:-79.377172,zoom:14},radius:"0.3",name:"Rosedale",location:{latitude:43.683375,longitude:-79.377172,zoom:14}},{slug:"toronto-chinatown",vibe:[2464,3005,7028],map:{lat:43.650883,lng:-79.397226,zoom:14},radius:"0.3",name:"Chinatown",location:{latitude:43.650883,longitude:-79.397226,zoom:14}},{slug:"yorkville",vibe:[6894,7478,7187],map:{lat:43.670749,lng:-79.39304,zoom:14},radius:"0.3",name:"Yorkville",location:{latitude:43.670749,longitude:-79.39304,zoom:14}},{slug:"kensington-market",vibe:[2034,4071,2119],map:{lat:43.6545236,lng:-79.4014566,zoom:14},radius:"0.3",name:"Kensington Market",location:{latitude:43.6545236,longitude:-79.4014566,zoom:14}},{slug:"harbourfront",vibe:[4111,1106,7001],map:{lat:43.6405521,lng:-79.3789371,zoom:14},radius:"0.3",name:"Harbourfront",location:{latitude:43.6405521,longitude:-79.3789371,zoom:14}},{slug:"the-east-cut",vibe:[3021,2037,3027,1687,6552],map:{lat:37.789218,lng:-122.3951488,zoom:17},radius:"0.3",name:"The East Cut",location:{latitude:37.789218,longitude:-122.3951488,zoom:17}},{slug:"49785",vibe:[2464,1073,5690,2230,7343,6552],map:{lat:34.0900091,lng:-118.3617443,zoom:14},radius:"0.4",name:"West Hollywood",location:{latitude:34.0900091,longitude:-118.3617443,zoom:14}},{slug:"chinatown-oakland",vibe:[1073,2230,1067,1906],map:{lat:37.797883489755385,lng:-122.26782583942565,zoom:16},radius:"0.1",name:"Chinatown",location:{latitude:37.797883489755385,longitude:-122.26782583942565,zoom:16}},{slug:"city-park",vibe:[],map:{lat:39.7437803,lng:-104.9500844,zoom:14},radius:"0.3",name:"City Park",location:{latitude:39.7437803,longitude:-104.9500844,zoom:14}},{slug:"lodo",vibe:[1064,1076,1906],map:{lat:39.7526509,lng:-105.001685,zoom:14},radius:"0.3",name:"LoDo",location:{latitude:39.7526509,longitude:-105.001685,zoom:14}},{slug:"nuevo-vallarta",vibe:[],map:{lat:20.6986205,lng:-105.2964898,zoom:14},radius:"0.3",name:"Nuevo Vallarta",location:{latitude:20.6986205,longitude:-105.2964898,zoom:14}},{slug:"5-de-diciembre",vibe:[1103,2230,1067,1785],map:{lat:20.6167287,lng:-105.2297199,zoom:14},radius:"0.2",name:"5 de Diciembre",location:{latitude:20.6167287,longitude:-105.2297199,zoom:14}},{slug:"versalles-la-vena",vibe:[3024,1060,2162],map:{lat:20.6350676,lng:-105.2275257,zoom:17},radius:"0.4",name:"Versalles &#038; La Vena",location:{latitude:20.6350676,longitude:-105.2275257,zoom:17}},{slug:"centro",vibe:[1100,1073,1067],map:{lat:20.6098697,lng:-105.2333768,zoom:16},radius:"0.4",name:"Centro",location:{latitude:20.6098697,longitude:-105.2333768,zoom:16}},{slug:"zona-romantica",vibe:[1073,1903,1701,6549,1956],map:{lat:20.6027765,lng:-105.2337149,zoom:14},radius:"0.3",name:"Zona Romantica",location:{latitude:20.6027765,longitude:-105.2337149,zoom:14}},{slug:"soma",vibe:[3021,1100,2034,6558],map:{lat:37.7785189,lng:-122.4056395,zoom:17},radius:"0.4",name:"SoMa",location:{latitude:37.7785189,longitude:-122.4056395,zoom:17}},{slug:"downtown-oakland",vibe:[1100,1903,1906],map:{lat:37.8032973,lng:-122.2710602,zoom:15},radius:"0.3",name:"Downtown Oakland",location:{latitude:37.8032973,longitude:-122.2710602,zoom:15}},{slug:"castro-san-francisco",vibe:[1103,1106,1070,6549,2119],map:{lat:37.7609082,lng:-122.4350043,zoom:16},radius:"0.3",name:"Castro",location:{latitude:37.7609082,longitude:-122.4350043,zoom:16}},{slug:"lafayette-obrera-guadalajara",vibe:[1100,1076,1701],map:{lat:20.669874401713777,lng:-103.37240438465577,zoom:16},radius:"0.3",name:"Lafayette / Obrera",location:{latitude:20.669874401713777,longitude:-103.37240438465577,zoom:16}},{slug:"fillmore-san-francisco",vibe:[5039,1073,2119],map:{lat:37.786566,lng:-122.4333927,zoom:15},radius:"0.3",name:"Fillmore District",location:{latitude:37.786566,longitude:-122.4333927,zoom:15}},{slug:"downtown-vancouver",vibe:[1100,2116,1956,2119],map:{lat:49.281954,lng:-123.1170744,zoom:11},radius:"0.2",name:"Downtown Vancouver",location:{latitude:49.281954,longitude:-123.1170744,zoom:11}},{slug:"jack-london-oakland",vibe:[1060,1109,1073,1687],map:{lat:37.79506910000001,lng:-122.2777955,zoom:14},radius:"0.3",name:"Jack London",location:{latitude:37.79506910000001,longitude:-122.2777955,zoom:14}},{slug:"monraz-guadalajara",vibe:[1106,2162,2119],map:{lat:20.6838829,lng:-103.3948334,zoom:15},radius:"0.3",name:"Monráz",location:{latitude:20.6838829,longitude:-103.3948334,zoom:15}},{slug:"tlaquepaque-guadalajara",vibe:[3021,2230,6561,4828],map:{lat:20.628807203160175,lng:-103.31384336079101,zoom:14},radius:"0.3",name:"Tlaquepaque",location:{latitude:20.628807203160175,longitude:-103.31384336079101,zoom:14}},{slug:"moderna-guadalajara",vibe:[1070,1067],map:{lat:20.663603891205657,lng:-103.3612885989502,zoom:15},radius:"0.3",name:"Moderna",location:{latitude:20.663603891205657,longitude:-103.3612885989502,zoom:15}},{slug:"chapalita-guadalajara",vibe:[1100,1106],map:{lat:20.663216991873846,lng:-103.39528387829588,zoom:17},radius:"0.3",name:"Chapalita",location:{latitude:20.663216991873846,longitude:-103.39528387829588,zoom:17}},{slug:"providencia-guadalajara",vibe:[1106,1076],map:{lat:20.7019816,lng:-103.378224,zoom:14},radius:"0.3",name:"Providencia",location:{latitude:20.7019816,longitude:-103.378224,zoom:14}},{slug:"zapopan-centro-guadalajara",vibe:[1100,1067,1076],map:{lat:20.6719563,lng:-103.416501,zoom:14},radius:"0.3",name:"Zapopan Centro",location:{latitude:20.6719563,longitude:-103.416501,zoom:14}},{slug:"centro-guadalajara",vibe:[1100,1067],map:{lat:20.6866131,lng:-103.3507872,zoom:14},radius:"0.3",name:"Centro",location:{latitude:20.6866131,longitude:-103.3507872,zoom:14}},{slug:"mexicaltzingo-guadalajara",vibe:[1100,2230,1067],map:{lat:20.6676254,lng:-103.3505188,zoom:14},radius:"0.3",name:"Mexicaltzingo",location:{latitude:20.6676254,longitude:-103.3505188,zoom:14}},{slug:"santa-tere-guadalajara",vibe:[1100,2230,2119],map:{lat:20.683636195948008,lng:-103.36814401852416,zoom:15},name:"Santa Tere",location:{latitude:20.683636195948008,longitude:-103.36814401852416,zoom:15}},{slug:"americana-guadalajara",vibe:[1701],map:{lat:20.6717775,lng:-103.3630608,zoom:15},radius:"0.3",name:"Americana",location:{latitude:20.6717775,longitude:-103.3630608,zoom:15}},{slug:"yaletown-vancouver",vibe:[],map:{lat:49.27570189999999,lng:-123.1199065,zoom:14},radius:"0.3",name:"Yaletown",location:{latitude:49.27570189999999,longitude:-123.1199065,zoom:14}},{slug:"west-end-vancouver",vibe:[1106,1067],map:{lat:49.2900541,lng:-123.1376044,zoom:14},radius:"0.3",name:"West End",location:{latitude:49.2900541,longitude:-123.1376044,zoom:14}},{slug:"north-vancouver",vibe:[1100,1106],map:{lat:49.3199816,lng:-123.0724139,zoom:14},radius:"0.3",name:"North Vancouver",location:{latitude:49.3199816,longitude:-123.0724139,zoom:14}},{slug:"gastown-vancouver",vibe:[1100,5039,1067,1687,2119],map:{lat:49.2828082,lng:-123.1066875,zoom:14},radius:"0.3",name:"Gastown",location:{latitude:49.2828082,longitude:-123.1066875,zoom:14}},{slug:"east-vancouver-vancouver",vibe:[1100,3005,1824,1073,1067],map:{lat:49.2530487,lng:-123.0663828,zoom:14},radius:"0.3",name:"East Vancouver",location:{latitude:49.2530487,longitude:-123.0663828,zoom:14}},{slug:"davie-village-vancouver",vibe:[1100,1106],map:{lat:49.2804157,lng:-123.1311982,zoom:14},radius:"0.3",name:"Davie Village",location:{latitude:49.2804157,longitude:-123.1311982,zoom:14}},{slug:"mississippi-avenue",vibe:[2464,3018,2119,2467],map:{lat:45.5467446,lng:-122.6755671,zoom:14},radius:"0.3",name:"Mississippi Avenue",location:{latitude:45.5467446,longitude:-122.6755671,zoom:14}},{slug:"st-johns-portland",vibe:[],map:{lat:45.5901167,lng:-122.7545431,zoom:14},radius:"0.3",name:"St Johns",location:{latitude:45.5901167,longitude:-122.7545431,zoom:14}},{slug:"jade-district",vibe:[1100,2119],map:{lat:45.50243139999999,lng:-122.5785098,zoom:12},radius:"0.3",name:"Jade District",location:{latitude:45.50243139999999,longitude:-122.5785098,zoom:12}},{slug:"hawthorne-portland",vibe:[3021,1100,2034,1067,2159],map:{lat:45.51206579999999,lng:-122.6305462,zoom:14},radius:"0.3",name:"Hawthorne",location:{latitude:45.51206579999999,longitude:-122.6305462,zoom:14}},{slug:"division-clinton-portland",vibe:[1100,2034,1166,5581,2119],map:{lat:45.5032867,lng:-122.6399541,zoom:17},radius:"0.3",name:"Division/Clinton",location:{latitude:45.5032867,longitude:-122.6399541,zoom:17}},{slug:"central-eastside-portland",vibe:[1073,1067,2119],map:{lat:45.523777,lng:-122.6598737,zoom:15},radius:"0.3",name:"Central Eastside",location:{latitude:45.523777,longitude:-122.6598737,zoom:15}},{slug:"chinatown-old-town-portland",vibe:[1106,1073,2119,1906],map:{lat:45.5246175,lng:-122.6740295,zoom:14},radius:"0.3",name:"Old Town / Chinatown",location:{latitude:45.5246175,longitude:-122.6740295,zoom:14}},{slug:"pioneer-square-seattle",vibe:[1073,1070,1067],map:{lat:47.6015184,lng:-122.3342975,zoom:14},radius:"0.3",name:"Pioneer Square",location:{latitude:47.6015184,longitude:-122.3342975,zoom:14}},{slug:"ballard-seattle",vibe:[1106,2162],map:{lat:47.6792172,lng:-122.3860312,zoom:15},radius:"0.3",name:"Ballard",location:{latitude:47.6792172,longitude:-122.3860312,zoom:15}},{slug:"mission-sanfrancisco",vibe:[1100,1103,1067,2119],map:{lat:37.7598648,lng:-122.4147977,zoom:15},radius:"0.3",name:"Mission District",location:{latitude:37.7598648,longitude:-122.4147977,zoom:15}},{slug:"green-lake-seattle",vibe:[1106,1076],map:{lat:47.6798338,lng:-122.3257826,zoom:15},radius:"0.3",name:"Green Lake",location:{latitude:47.6798338,longitude:-122.3257826,zoom:15}},{slug:"georgetown-seattle",vibe:[1106,1067],map:{lat:47.5475104,lng:-122.3214521,zoom:15},radius:"0.3",name:"Georgetown",location:{latitude:47.5475104,longitude:-122.3214521,zoom:15}},{slug:"queen-anne-seattle",vibe:[],map:{lat:47.6323268,lng:-122.3568641,zoom:15},radius:"0.3",name:"Queen Anne",location:{latitude:47.6323268,longitude:-122.3568641,zoom:15}},{slug:"capitol-hill-seattle",vibe:[1100,1073,6549,2119,5559],map:{lat:47.625305,lng:-122.3221835,zoom:15},radius:"0.3",name:"Capitol Hill",location:{latitude:47.625305,longitude:-122.3221835,zoom:15}},{slug:"chinatown-seattle",vibe:[],map:{lat:47.5987122,lng:-122.3239762,zoom:15},radius:"0.3",name:"Chinatown-International District",location:{latitude:47.5987122,longitude:-122.3239762,zoom:15}},{slug:"fruitvale-oakland",vibe:[1070,1903,1906],map:{lat:37.7776559,lng:-122.2258763,zoom:15},radius:"0.3",name:"Fruitvale",location:{latitude:37.7776559,longitude:-122.2258763,zoom:15}},{slug:"west-oakland-oakland",vibe:[2464,1067],map:{lat:37.8155761,lng:-122.2839963,zoom:14},radius:"0.3",name:"West Oakland",location:{latitude:37.8155761,longitude:-122.2839963,zoom:14}},{slug:"temescal-oakland",vibe:[1067,2119],map:{lat:37.8333513,lng:-122.260109,zoom:15},radius:"0.3",name:"Temescal",location:{latitude:37.8333513,longitude:-122.260109,zoom:15}},{slug:"inner-sunset-san-francisco",vibe:[1106,2119],map:{lat:37.764133875773645,lng:-122.46626644229737,zoom:15},name:"Inner Sunset",location:{latitude:37.764133875773645,longitude:-122.46626644229737,zoom:15}},{slug:"hayes-valley-san-francisco",vibe:[1106,2119],map:{lat:37.7759073,lng:-122.4245247,zoom:15},radius:"0.3",name:"Hayes Valley",location:{latitude:37.7759073,longitude:-122.4245247,zoom:15}},{slug:"marina-san-francisco",vibe:[1782,1701,1687],map:{lat:37.8036667,lng:-122.4368151,zoom:15},radius:"0.3",name:"Marina",location:{latitude:37.8036667,longitude:-122.4368151,zoom:15}},{slug:"bay-view",vibe:[1070,1067,1076],map:{lat:37.73465859016705,lng:-122.3908183862915,zoom:15},radius:"0.3",name:"Bayview",location:{latitude:37.73465859016705,longitude:-122.3908183862915,zoom:15}},{slug:"japantown",vibe:[1060,1103,1106,1109,1064],map:{lat:37.7854135,lng:-122.429383,zoom:14},radius:"0.3",name:"Japantown",location:{latitude:37.7854135,longitude:-122.429383,zoom:14}},{slug:"north-beach",vibe:[],map:{lat:37.80035660509935,lng:-122.41009506560668,zoom:15},radius:"0.3",name:"North Beach",location:{latitude:37.80035660509935,longitude:-122.41009506560668,zoom:15}},{slug:"haight-ashbury-san-francisco",vibe:[1103,1106],map:{lat:37.7692204,lng:-122.4481393,zoom:15},radius:"0.3",name:"Haight-Ashbury",location:{latitude:37.7692204,longitude:-122.4481393,zoom:15}},{slug:"chinatown-vancouver",vibe:[1073,1070,1067],map:{lat:49.2801149,lng:-123.1058197,zoom:13},radius:"0.3",name:"Chinatown",location:{latitude:49.2801149,longitude:-123.1058197,zoom:13}},{slug:"chinatown",vibe:[1100,2116,1067],map:{lat:37.7941378,lng:-122.4077914,zoom:16},radius:"0.3",name:"Chinatown",location:{latitude:37.7941378,longitude:-122.4077914,zoom:16}},{slug:"koreatown-northgate",vibe:[3008,1064,5690,3018,1906],map:{lat:37.809589965684175,lng:-122.26953311691895,zoom:16},radius:"0.4",name:"Koreatown Northgate",location:{latitude:37.809589965684175,longitude:-122.26953311691895,zoom:16}}],badges=[{slug:"downtown-portland-summer-challenge",status:"publish",vibe:[],badge_family:[],key:"downtown-portland-summer-challenge",description:"<p>Unlock prizes and embrace local adventures while you explore Downtown Portland this summer.</p>\n",has_location:!0,map:{address:"Downtown Portland, Portland, OR, USA",lat:45.5173454,lng:-122.6835562,city:"Portland",name:"Portland Downtown",zoom:14},icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2020/06/Vibemap_City_Portland-17.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"Downtown Portland Summer Challenge",location:{ID:1441,post_title:"Portland",post_name:"portland"}},{slug:"downtown-oakland-summer-challenge",status:"publish",vibe:[],badge_family:[],key:"downtown-oakland-summer-challenge",description:"<p>Unlock prizes and embrace local adventures while you explore Downtown Oakland this summer. This challenge runs now through August 21st, 2023!</p>\n",has_location:!0,map:{address:"Oakland, CA, USA",lat:37.8043514,lng:-122.2711639,city:"Oakland",name:"Oakland",zoom:14},icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2023/05/Downtown-Oakland-Challenge_Badge-01-3.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"Downtown Oakland Summer Challenge",location:{ID:1447,post_title:"Oakland",post_name:"oakland"}},{slug:"art-about-town-treasure-hunt-general",status:"publish",vibe:[],badge_family:[],key:"art-about-town-treasure-hunt-general",description:"<p>Grab your map, don your artistic spirit, and let the exploration begin!</p>\n",has_location:!0,icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2023/05/Art-About-Town-Treasure-Hunt-Badge-Vibemap-Small.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"Art About Town Treasure Hunt ",location:{ID:1447,post_title:"Oakland",post_name:"oakland"}},{slug:"art-about-town-treasure-hunt-2",status:"publish",vibe:[],badge_family:[],key:"art-about-town-treasure-hunt-2",description:"<p>Grab your map, don your artistic spirit, and let the exploration begin!</p>\n",has_location:!0,icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2023/05/Art-About-Town-Treasure-Hunt-Badge-East-Bay-Small.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"Art About Town Treasure Hunt East Bay",location:{ID:1447,post_title:"Oakland",post_name:"oakland"}},{slug:"art-about-town-treasure-hunt-berkeley",status:"publish",vibe:[],badge_family:[],key:"art-about-town-treasure-hunt-berkeley",description:"<p>Grab your map, don your artistic spirit, and let the exploration begin!</p>\n",has_location:!0,icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2023/05/Art-About-Town-Treasure-Hunt-Badge-Berkeley-Small.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"Art About Town Treasure Hunt Berkeley",location:{ID:1447,post_title:"Oakland",post_name:"oakland"}},{slug:"art-about-town-treasure-hunt",status:"publish",vibe:[],badge_family:[],key:"art-about-town-treasure-hunt",description:"<p>Grab your map, don your artistic spirit, and let the exploration begin!</p>\n",has_location:!0,icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2023/05/Art-About-Town-Treasure-Hunt-Badge-Oakland-Small.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"Art About Town Treasure Hunt Oakland",location:{ID:1447,post_title:"Oakland",post_name:"oakland"}},{slug:"56132",status:"publish",vibe:[],badge_family:[],key:"56132",description:"<p>Explore Downtown San Jose and Win Prizes.</p>\n",has_location:!0,icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2023/03/50932693_10161385073470364_2256098350099070976_n.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"San Jose Downtown Challenge",location:{ID:55524,post_title:"San Jose",post_name:"san-jose"}},{slug:"open-peoria",status:"publish",vibe:[],badge_family:[],key:"open-peoria",description:"<p>Check in with Vibemap once to enter the Open Peoria Challenge and earn a FREE Vibemap mug.</p>\n<p>&nbsp;</p>\n<p>Check in five times to be entered into a raffle to win a special Discover Peoria Vibemap prize!</p>\n<p>&nbsp;</p>\n<p>Pick up your free mug from Noah on Tuesday at the Peoria Civic Center.</p>\n",has_location:!0,icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2023/01/Discover-Peoria.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"Open Peoria",location:{ID:52306,post_title:"Peoria",post_name:"peoria"}},{slug:"dvbia",status:"publish",vibe:[],badge_family:[],key:"dvbia",description:"<p>Unlock specials and win prizes by joining the downtown Vancouver Neighborhood Challenge</p>\n",has_location:!0,icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2023/03/Vancouver-01.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"downtown Vancouver Neighbourhood Challenge",location:{ID:1435,post_title:"Vancouver",post_name:"vancouver"}},{slug:"52322",status:"publish",vibe:[],badge_family:[],key:"52322",description:"",has_location:!1,icon:{url:"https://vibemap.wpengine.com/wp-content/uploads/2022/07/knowledge.jpg",icon:"https://vibemap.wpengine.com/wp-includes/images/media/default.png"},name:"Know it All"}],badges$1={badges:badges};axiosRetry__default.default(Axios__default.default,{retries:3,retryDelay:axiosRetry__default.default.exponentialDelay,onRetry:(e,a,t)=>{console.log("Axios retrying: ",e,a,t)}});const axios=Axios__default.default,jsonpack=(dayjs__default.default.extend(isBetween__default.default),dayjs__default.default.extend(dayjsRecur__default.default),require("jsonpack"));let activityCategories={},categories_flat=[];const getAPIDomain=(e=null)=>{var a=process.env.API_ENV,e=e||a||"production";return"production"===e?"https://api.vibemap.com":"staging"===e?"https://staging.api.vibemap.com":"http://localhost:9000"},api_domain=getAPIDomain(),api_version="v0.3",ApiUrl=`${api_domain}/${api_version}/`,filterList=(e=[{test:"test",value:"foo"},{test:"test",value:"bar"}],a="food",t="value")=>{const o=new RegExp(a.replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g,"\\$&"),"i");return e.filter(e=>(e=>o.test(e[t]))(e))},getRandomItem=e=>{return e[Math.floor(Math.random()*e.length)]},encodeCardIndex=(e,a)=>{return e+a/10},matchLists=(e,a)=>{let t=0;return t=0<e.length&&0<a.length?e.filter(e=>a.includes(e)).length:t},rankVibes=(e,t)=>{let a=[];return(a=e.map(e=>{let a=0;return a=t.includes(e)?t.length-t.indexOf(e):a})).reduce((e,a)=>e+a,0)/t.length},sortByKey=(e,a)=>(console.log("sortByKey (a, b)",e,a),e),sortByPopularity=(e,a)=>{e=parseInt(e.details.msv||2);return parseInt(a.details.msv||2)-e};try{const V=require("../dist/activityCategories.zip.json");activityCategories={activityCategories:jsonpack.unpack(V)},categories_flat=activityCategories.activityCategories.sort(sortByPopularity).map(e=>e.name.toLowerCase())}catch(e){console.log("Error with packed activityCategories ",e)}const sortByArray=(e,t)=>e.sort((e,a)=>t.indexOf(e)-t.indexOf(a)),isClosedToday=e=>"00:00:00"===e.opens&&"00:00:00"===e.closes,displayHours=(t,o="dd")=>{var a=isOpen(t),i=t.find(({day_of_week:e})=>8===e);if(a.openEveryday){let e=[];a=dayjs__default.default(a.opens).format("ha")+"-"+dayjs__default.default(a.closes).format("ha"),a=(e.push(a),t.find(e=>"POPULAR"==e.name));return console.log("Popular at: ",a),e}let n=0,r=[];for(;n<7;){let e=t.find(e=>e.day_of_week==n),a=(t.find(e=>e.day_of_week==n&&"POPULAR"==e.name),!1);if(void 0!==e&&(a=isClosedToday(e)),void 0===e||a)if(a||void 0===i)r.push({day_of_week:n,closed:!0});else{let e=Object.assign({},i);e.day_of_week=n,r.push(e)}else e.closed=!1,r.push(e);n++}return r.map(e=>{var a,t=(e.day_of_week+1)%7;return!0===e.closed?dayjs__default.default().day(t).format(o)+": Closed":(a=e.opens.split(":"),e=e.closes.split(":"),dayjs__default.default().day(t).format(o)+": "+dayjs__default.default().hour(a[0]).minute(a[1]).format("ha")+"-"+dayjs__default.default().hour(e[0]).minute(e[1]).format("ha"))})},isOpen=(e,a=dayjs__default.default())=>{const t=a.day();var o=a.format("YYYY-MM-DD");if(a.hour(),!e)return{openNow:!1,openToday:!1,isPopular:!1};let i=e.find(({day_of_week:e})=>e===t);var n=e.find(({day_of_week:e})=>8===e),e=e.filter(e=>isClosedToday(e)),e=void 0!==n&&0==e.length;if(i=void 0===i?n:i){const r=dayjs__default.default(o+" "+i.opens),l=dayjs__default.default(o+" "+i.closes);n=a.isBetween(r,l),o=n&&"POPULAR"===i.name;return r.format("ha"),l.format("ha"),{openNow:n,openToday:!0,openEveryday:e,opens:r,closes:l,isPopular:o}}return{openNow:!1,openToday:!1,openEveryday:!1,isPopular:!1}},parseDateTime=e=>{return e?dayjs__default.default(e):null},formatDateTime=(e,a=0,t=!1)=>{var o,i,n;return e?(o=(e="string"==typeof e?parseDateTime(e):e).format("MMM"),i=e.format("D"),n=e.format("ddd"),`${t?n:null} ${o} ${i} `+e.format("ha")):null},getCardOptions=a=>{let{categoryQuery:e,distanceQuery:t,geoQuery:o,searchQuery:i,vibeQuery:n}=a.singCards.posts[0];a.overrideQuery&&a.overrideQuery.vibe&&(n=a.overrideQuery.vibe),a.overrideQuery&&a.overrideQuery.cities&&0<a.overrideQuery.cities.length&&(r=cities.filter(e=>e.slug===a.overrideQuery.cities[0]),o=o||r[0].location,t=t||7),a.overrideQuery&&a.overrideQuery.location&&(o=a.overrideQuery.location,t=a.overrideQuery.distance||t),o||(r=cities.filter(e=>"oakland"===e.slug),o=r[0].location);var r=(n="string"==typeof n?n.replace(/\s/g,"").split(","):n)?n.map(e=>"string"==typeof e?e:e.slug):[];return{category:e,distance:t,point:o.longitude+","+o.latitude,ordering:"vibe",search:i,vibes:r}},getAPIParams=(e,a=150,t=!1)=>{let{activity:o,distance:i,point:n,vibes:r}=e,l=Object.assign({},e),s=1;0<i&&(s=Math.round(i*constants.METERS_PER_MILE)),l.ordering=e.ordering||"-aggregate_rating",l.per_page=a;var a=n.split(","),u=a[1],a=a[0];return l.activity&&(l.categories=o),l.tags&&(l["tags.raw__in"]=tags,delete l.tags),l.vibes&&(l[":vibes.raw__in"]=r,delete l.vibes),l.category&&(l.categories="string"==typeof l.category?l.category.toLowerCase().split():l.category),l.distance&&(l.location__geo_distance=s+`m__${u}__`+a,delete l.distance),l.search&&0<l.search.length&&("east bay open studios".includes(l.search)&&(l.editorial_category="EastBayOpenStudios"),delete l.ordering,delete l[":vibes.raw__in"]),l.editorial_category&&(u=l.editorial_category,l["editorial_categories.raw__wildcard"]=`*${u}*`,delete l.editorial_category),l.is_chain=e.is_chain||!1,l.is_closed=e.is_closed||!1,l.is_destination=e.is_destination||!1,l.city&&(l["city.raw__contains"]=l.city,delete l.city),l.per_page&&(l.page_size=l.per_page,delete l.per_page),"all"!==o&&null!==o&&(l.category=o),l.dist=s,delete l.activity,delete l.distance,delete l.bounds,null==l.city&&delete l.city,null!=l.category&&"all"!=l.category&&0!=l.category.length||delete l.category,null==l.editorial_category&&delete l.editorial_category,null==l.search&&delete l.search,null!=l.vibes&&0!=l.vibes.length||delete l.vibes,0==t&&delete l.relatedVibes,l},getCategoryMatch=(e=["all"])=>{const a=activityCategories.activityCategories.map(e=>e.slug);let t=[];return e.map(e=>(a.includes(e)&&t.push(e),!0)),t},getFullLink=(e,a="instagram")=>{if(null===e||""===e)return null;const t=o.parse(e);let o=new URL(e);e=t.path.replace("/","");return{instagram:"https://instagram.com/",twitter:"https://twitter.com/",facebook:"https://facebook.com/"}[a]+e},geLocationFromCity=e=>{return e.cityDetails?e.cityDetails.placemarker:e.location||null},getMax=(e,a)=>{let t=0;return e.forEach(e=>{e=e.properties[a];e>t&&(t=e)}),t},getMin=(e,a)=>{let t=100;return e.forEach(e=>{e=e.properties[a];e<t&&(t=e)}),t},getTimeOfDay=e=>{if(e&&e.isValid())return e=parseFloat(e.format("HH")),12<=e&&e<=17?"afternoon":17<=e?"evening":"morning"},getTopLocations=(e,t="city",a=!1)=>{let o={};e.map(e=>{const a=e.properties[t];return null!=a&&"null"!=a&&(e=a.split(",")[0],o.hasOwnProperty(a)?o[e]+=1:o[e]=1),null});var i,n=[];for(i in o)n.push([i,o[i]]);let r=n.sort(function(e,a){return a[1]-e[1]});return a?r.map(e=>e[0]):r},getTopVibes=(e,a=!1)=>{let t={};e.map(e=>(e.properties.vibes.map(e=>(t.hasOwnProperty(e)?t[e]+=1:t[e]=1,null)),null));var o,i=[];for(o in t)i.push([o,t[o]]);let n=i.sort(function(e,a){return a[1]-e[1]});return a?n.map(e=>e[0]):n},getTopCategories=(e,a="categories")=>{let t={};e.map(e=>(e.properties[a].map(e=>(t.hasOwnProperty(e)?t[e]+=1:t[e]=1,null)),null));var o,i=[];for(o in t)i.push([o,t[o]]);return i.sort(function(e,a){return a[1]-e[1]})},getWaveFromVibe=e=>"buzzing"!==e?"medium":"high",graphToEvents=(e=[])=>{return e.map(e=>{e=e.node;const a=e.groupDetails;var t=a.name,o=a.link,e=e.slug,i=a.description,n=a.image?a.image.url:null,n=[{url:n,original:n}],r=a.map,l=a.price||"free",s=a.vibes?a.vibes.map(e=>e.slug):[],u=(a.recurring,a.recurrence),c=a.which,d=a.day.value,g=a.startTime||"00:00",p=a.startTime?a.endTime:"00:00";const m=nextDateFromRecurring(u,d,c);u=dayjs__default.default(m.next(1).toLocaleString().replace("00:00:00",g)),d=dayjs__default.default(m.next(1).toLocaleString().replace("00:00:00",p));return{id:e,title:t,geometry:{type:"Point",coordinates:[-122.26747099999956,37.81396520000001]},dateTime:u,image:n,card_type:"event",properties:{name:t,title:t,url:o,address:r&&r.streetAddress,categories:[],city:a.cities&&a.cities[0].slug,description:i,is_online:!1,images:[],hotspots_place:r,location:r,start_date:u,end_date:d,vibemap_images:n,likes:10,price:l,recurs:!0,vibes:s}}})},groupsToEvents=(e=[])=>{return e.map(e=>{const a=e.acf;var t=a.name,o=a.link,e=e.slug,i=a.description,n=a.image&&a.image.url,n=n?[{url:n,original:n}]:[],r=a.map,l=a.price||"free",s=a.vibes?a.vibes.map(e=>e.slug):[],u=(a.recurring,a.recurrence),c=a.which,d=a.day&&a.day.label?a.day.label:"sunday",g=a.start_time||"00:00",p=a.end_time||"00:00";const m=nextDateFromRecurring(u,d,c),_=dayjs__default.default(m.next(1).toLocaleString().replace("00:00:00",g)),b=dayjs__default.default(m.next(1).toLocaleString().replace("00:00:00",p));return{id:e,title:t,geometry:{type:"Point",coordinates:[-122.26747099999956,37.81396520000001]},dateTime:_.toISOString(),image:n,card_type:"event",properties:{name:t,title:t,url:o,address:r&&r.streetAddress,categories:[],city:a.cities&&a.cities[0].slug,description:i,is_online:!1,images:n,hotspots_place:r,location:r,start_date:_.toISOString(),end_date:b.toISOString(),vibemap_images:n,likes:10,price:l,recurs:!0,vibes:s}}})},normalize=(e,a,t)=>(e-a)/(t-a)*10,normalize_all=(e=500,a=1,t=100,o=1,i=10)=>{const n=LinearScale__default.default().domain([a,t]).range([o,i]);return n(e)},scaleIconSize=(e=5,a=1,t=100)=>{const o=LinearScale__default.default().domain([a,t]).range([1,5]);return o(e)},scaleMarker=(e=50,a,t=100,o=14)=>{isNaN(e)&&(e=3.5);const i=LinearScale__default.default().domain([8,20]).range([10,30]);var o=i(o),n=3*o;let r=LinearScale__default.default().domain([0,t]).range([o,n]);return Math.round(r(e))},scaleDensityArea=(e=10,a)=>{let t=LinearScale__default.default().domain([1,60,1e3]).range([0,.8,1]);return t(e)},scaleDensityBonus=e=>{let a=LinearScale__default.default().domain([0,1]).range([2*constants.HEATMAP_INTENSITY,constants.HEATMAP_INTENSITY]);return a(e)},scaleScore=(e=2)=>{let a=LinearScale__default.default().domain([0,5]).range([60,100]);return Math.round(a(e))},scaleSelectedMarker=e=>{let a=LinearScale__default.default().domain([8,12,20]).range([.1,1.2,4]);return Math.round(a(e))},getEventOptions=(a="oakland",e="quarter",t=10,o=null,i=[],n)=>{const r=cities.concat(neighborhoods);var l=r.filter(e=>e.slug===a),l=l?l[0].location:cities[0];const s=dayjs__default.default();var u=s.day()+1;s.startOf("day");let c=0,d=0;switch(e){case"day":d=1;break;case"weekend":d=7-u;break;case"next_week":c=8-u,d=7;break;case"month":const _=s.endOf("month");d=_.diff(s,"day");break;case"quarter":d=90}let g=s.add(c,"day").startOf("day"),p=s.add(d,"day").endOf("day"),m={activity:o,category:o,distance:t,point:l.longitude+","+l.latitude,ordering:"-score_combined",start_date_after:g.format("YYYY-MM-DD HH:MM"),end_date_before:p.format("YYYY-MM-DD HH:MM"),search:n,vibes:i};return null!=m.category&&"all"!=m.category&&0!=m.category.length||delete m.category,null==m.search&&delete m.search,null!=m.vibes&&0!=m.vibes.length||delete m.vibes,m},fetchEvents=async(e={distance:20,point:"-122.269994,37.806507"},a=!1,t=!1)=>{let{category:o,days:i,point:n,search:r}=e;var l=n.split(",").map(e=>parseFloat(e)),l=map.getLocationFromPoint(l),a=(dayjs__default.default().startOf("day").format("YYYY-MM-DD HH:MM"),dayjs__default.default().add(i,"days").format("YYYY-MM-DD HH:MM"),a&&o&&(e.search=`${o||""} `+(r||"")),map.sortLocations(cities,l)),l=a&&0<a.length?a[0].name:null,a=module.exports.getAPIParams(e),e=querystring__default.default.stringify(a),a=ApiUrl+"events/",s=axios.CancelToken.source();let u=await axios.get(a+"?"+e,{cancelToken:s.token}).catch(function(e){return console.log("Axios error ",e.response&&e.response.statusText),{data:[],count:0,top_vibes:null,loading:!1,timedOut:!1}});if(t){a=await wordpress.getGroups({city:l||""});const c=groupsToEvents(a.data);u.data.results.features=c.concat(u.data.results.features)}return u},nextDateFromRecurring=(...[e,a,t])=>{const o=dayjs__default.default();t=["first","second","third","fourth","fifth"].indexOf(t),t=0<t?t:0;return"monthly"==e?o.recur().every(a).daysOfWeek().every([t]).weeksOfMonthByDay():o.recur().every(a).daysOfWeek()},fetchPlacesDetails=async(e,a="place")=>{var t=axios.CancelToken.source();let o;if("event"==a&&(o=ApiUrl+"events/"),o="place"==a?ApiUrl+"places/":o)return await axios.get(""+o+e,{cancelToken:t.token}).catch(function(e){return console.log("axios error ",e&&e.statusText),null})},fetchPlacePicks=async(a={distance:5,point:"-123.1058197,49.2801149",ordering:"-score_combined",tags:[],vibes:["chill"],preferredVibes:[],relatedVibes:[]})=>{let{activity:e,ordering:t,per_page:o,point:i,vibes:n,preferredVibes:r,relatedVibes:l,useNearest:s=!1}=a;const u=o||100;var c=n&&0<n.length,d=i.split(",").map(e=>parseFloat(e)),g=map.getLocationFromPoint(d),p=map.sortLocations(cities,g),g=map.distanceBetweenLocations(p[0].location,g);if(s&&g<20){const v=p[0];a.point=v.centerpoint.join(",")}const m=ApiUrl+"search/places",_=axios.CancelToken.source();let b={};g=async e=>{e=getAPIParams(e,u);let a=querystring__default.default.stringify(e);return console.log("Places search query is ",m+"?"+a),b=await axios.get(m+"?"+a,{cancelToken:_.token}).catch(function(e){return console.log("axios error ",e.response&&e.response.statusText),{data:[],count:0,query:"?"+a,top_vibes:null,loading:!1,timedOut:!1}})},p=(b=await g(a)).data.count;if(0==p&&c){let e=Object.assign({},a);e.search=n[0],e.vibes=[],b=await g(e)}c=b.data&&b.data.results&&b.data.results.features?b.data.results.features:[],g=formatPlaces(c);const f=n||[];var c=f.concat(r||[]),h={...a,relatedVibes:l},d=scorePlaces(g,d,c,["aggregate_rating","vibes","distance","offers","hours"],t,!(!a||!a.shouldShuffle)&&a.shouldShuffle,h),c=getTopCategories(g),a=getTopVibes(g);return{data:d,count:p,top_categories:c,top_locations:getTopLocations(g),top_vibes:a,loading:!1,timedOut:!1}},fetchPlacesFromSearch=async e=>{const a=new URLSearchParams([["query",""],["latitude",e.latitude],["longitude",e.longitude]]);return await axios.get("https://dev.vibemap.com/search_places?"+a.toString()).catch(function(e){return console.log("axios error ",e.response&&e.response.statusText),{data:[],count:0,query:"?",top_vibes:null,loading:!1,timedOut:!1}})},fetchPlacesFromIds=async(e=["740b43a4-3925-4413-9414-fff9d8d16932","c8262c66-1a83-4d4b-a3e6-8710864ffd1f"])=>{var a=ApiUrl+"/search/places",e=(params=new URLSearchParams([["ids",e.join("__")]]),await axios.get(a+"?"+params.toString()).catch(function(e){return console.log("axios error ",e.response&&e.response.statusText),{data:[],error:e,count:0,query:"?"+params,top_vibes:null,loading:!1,timedOut:!1}})),a=e.data.count;return{data:e.data&&e.data.results&&e.data.results.features?e.data.results.features:[],count:a,loading:!1,timedOut:!1}},decodePlaces=e=>{return e.map(e=>(e.properties.vibes=JSON.parse(e.properties.vibes),e.properties.subcategories=JSON.parse(e.properties.subcategories),e.properties.categories=JSON.parse(e.properties.categories),e.properties.vibemap_images=[],e.properties.images=[e.properties.thumbnail_url],null!=e.properties.opening_hours&&(e.properties.opening_hours=JSON.parse(e.properties.opening_hours)),delete e.properties.tips,delete e.properties.facebook,delete e.properties.telephone,delete e.properties.website,e))},formatPlaces=(e=[])=>{const i=categories_flat,n=vibes.getCategoriesByLevel(2).map(e=>e.slug);return e.map(e=>{if(!e)return null;let a=e.properties;a.place_type="places",a.short_name=truncate__default.default(a.name,constants.TRUCATE_LENGTH),a.aggregate_rating=parseFloat(a.aggregate_rating),null==a.aggregate_rating_count&&(a.aggregate_rating_count=1),a.num_vibes=a.vibes.length,a.sub_categories=a.sub_categories,a.top_vibe=null;var t=a.categories.map(e=>(e="Drink"==e?"Drinking":e).toLowerCase()).filter(e=>n.includes(e.toLowerCase())),t=sortByArray(t,i),o=(void 0!==a.categories&&0!==a.categories.length||(a.categories=["place"]),t[0]||"dot");return a.icon=t[0]?`icon_${o}_light`:o,a.cluster=null,e.properties=a,e}).filter(Boolean)},vibesFromPlaces=e=>{return[]},getRecommendedVibes=e=>{return[]},scorePlaces=(e,u,c=[],d=["vibes","aggregate_rating","distance"],a,t=!0,o=12,g={})=>{let p={};let m={};d.map(e=>p[e]=1e-5),d.map(e=>m[e]=1/0);o=o<=10?10:o,o=normalize_all(o,10,20,0,10);let n={category:0,vibe:10,distance:8/(1+7*Math.exp(1)**(-.7*o)),rating:4,hours:0,offers:0};"relevance"!==a&&(n[a]+=3);const i=e.map(e=>{let t=e.properties;if(t.stats={},d.includes("vibes")){let[e,a]=[0,0];void(t.vibes_score=0)===t.vibes&&(t.vibes=["chill"]);var i=0<t.vibes.length?2*Math.log10(t.vibes.length):0;0<t.vibes.length&&(t.vibes_score=i),t.images&&0<t.images.length&&(a+=0<t.images.length?2*Math.log10(t.images.length):0),c&&0<c.length&&t.vibes&&(i=10*(e=matchLists(c,t.vibes))+2*(g.relatedVibes?matchLists(g.relatedVibes,t.vibes):0),o=+rankVibes(c,t.vibes),a+=i+o,t.vibes_score+=a,t.stats.num_vibes=t.vibes.length,t.stats.num_matching_vibes=e,t.stats.vibe_match_score=i,t.stats.vibe_order_score=o),t.vibes_score>p.vibes&&(p.vibes=t.vibes_score),t.vibes_score<m.vibes&&(m.vibes=t.vibes_score),t.stats.total_vibe_score=t.vibes_score}if(d.includes("categories")){i=[0][0];t.categories_score=0;const l=t.categories.concat(t.subcategories),s=l.filter((e,a)=>l.indexOf(e)==a);if(0<t.categories.length&&(t.categories_score=t.categories.length),0<c.length){let o=[];s.forEach(a=>{var e=constants.place_sub_categories.filter(e=>e.main_category.includes(a)),t=constants.place_sub_categories.filter(e=>e.name.includes(a));0<e.length&&(o=o.concat(e[0].vibes)),0<t.length&&(o=o.concat(t[0].vibes))});i=matchLists(c,o);t.categories_score+=10*i}t.categories_score>p.categories&&(p.categories=t.categories_score),t.categories_score<m.categories&&(m.categories=t.categories_score)}var o,a,n,r;return d.includes("likes")&&(t.likes>p.likes&&(p.likes=t.likes),t.likes<m.likes&&(m.likes=t.likes)),d.includes("distance")&&(o=turf__namespace.point(e.geometry?e.geometry.coordinates:[0,0]),t.distance=turf_distance__default.default(u,o),t.distance>p.distance&&(p.distance=t.distance),t.distance<m.distance&&(m.distance=t.distance)),d.includes("aggregate_rating")&&(t.aggregate_rating>p.aggregate_rating&&(p.aggregate_rating=t.aggregate_rating),t.aggregate_rating<m.aggregate_rating&&(m.aggregate_rating=t.aggregate_rating),null==m.aggregate_rating_count&&(m.aggregate_rating_count=1,p.aggregate_rating_count=1),t.aggregate_rating_count>p.aggregate_rating_count&&(p.aggregate_rating_count=t.aggregate_rating_count),t.aggregate_rating_count<m.aggregate_rating_count&&(m.aggregate_rating_count=t.aggregate_rating_count)),t.offers_score=0,t.hours_score=0,d.includes("offers")&&(t.offers&&0<t.offers.length&&(t.offers_score=2),{openNow:i,openToday:o,opens:a,closes:n,isPopular:r}=isOpen(t.opening_hours),t.open_now=i,t.popular_now=r,t.opens=a,t.closes=n,o&&(t.hours_score+=.5),i&&(t.hours_score+=.5),r&&(t.hours_score+=5)),t.stats.hours_bonus=t.hours_score,e.properties=t,e});let r=0,l=1/0,s=i.map(e=>{let a=e.properties;d.includes("vibes")&&(a.vibes_score=normalize_all(a.vibes_score,m.vibes,p.vibes,0,1),a.vibes_score=a.vibes_score*n.vibe),d.includes("categories")&&(a.categories_score=normalize_all(a.categories_score,m.categories,p.categories,0,1),a.categories_score=a.categories_score*n.category),d.includes("likes")&&(a.likes_score=normalize_all(a.likes,m.likes,p.likes,0,1)),d.includes("venue")&&(a.venue_score=normalize_all(a.place_vibe_count,m.likplace_vibe_countes,p.place_vibe_count,0,1)),d.includes("aggregate_rating")&&(i=normalize_all(a.aggregate_rating,m.aggregate_rating,p.aggregate_rating,0,1),t=normalize_all(a.aggregate_rating_count,m.aggregate_rating_count,p.aggregate_rating_count,0,1),a.aggregate_rating_score=(i+t)/2,a.aggregate_rating_score*=n.rating,a.stats.aggregate_rating_score=a.aggregate_rating_score),d.includes("distance")&&(i=p.distance,a.distance_score=1-normalize_all(a.distance,m.distance,i,0,.95),a.distance_score*=n.distance,a.stats.distance_score=a.distance_score),d.includes("hours")&&(a.hours_score*=n.hours);var t=d;const o=d.map(e=>a[e+"_score"]);var i=o.indexOf(Math.max.apply(null,o));return o.indexOf(Math.min.apply(null,o)),a.average_score=o.reduce((e,a)=>e+a,0)/o.length,a.average_score>r&&(r=a.average_score),a.average_score<l&&(l=a.average_score),a.reason=t[i],e.properties=a,e});const _=s.sort((e,a)=>a.properties.average_score-e.properties.average_score);o=_.map(e=>{let a=e.properties;return a.average_score=normalize_all(a.average_score,l,r,.65,1),a.icon_size=scaleIconSize(a.average_score,.65,1),a.stats.final_score_normalized=a.average_score,e}),a=o.length;return t&&100<a?module.exports.shuffleTopPicks(o):o},reducePlaceProperties=(e,t=["name","url","address","categories","subcategories","neighborhood","price","short_description","vibemap_images","vibes"])=>{return e.map(a=>(a.properties=Object.fromEntries(t.map(e=>[e,a.properties[e]])),a))},shuffleTopPicks=(e,a=20)=>{const t=e.slice(0,a).map(e=>({value:e,sort:Math.random()})).sort((e,a)=>e.sort-a.sort).map(({value:e})=>e);e=e.slice(a);return t.concat(e)},toTitleCase=e=>{if("string"!=typeof e)return e;e=e.toLowerCase().split(" ");for(var a=0;a<e.length;a++)e[a]=e[a].charAt(0).toUpperCase()+e[a].slice(1);return e.join(" ")},nearest_places=(e,o,i=5)=>{var n=[],e=(e.map(e=>{let a=e.properties;var t=turf__namespace.point(e.geometry.coordinates);a.distance=turf_distance__default.default(o,t),a.distance<i&&n.push(e)}),n.slice(0));return e.sort(function(e,a){return e.properties.distance-a.properties.distance}),e},validate_check_in=(e,a,t=.5)=>{e=turf__namespace.point(e.geometry.coordinates);return turf_distance__default.default(a,e)<t},in_jls=e=>{var a=turf__namespace.polygon([[[-122.282617,37.802862],[-122.2643,37.795721],[-122.265502,37.787005],[-122.288139,37.796077],[-122.282617,37.802862]]]);return turf_boolean__default.default(e,a)},in_neighborhood=t=>{const o=[],i=[],n=turf__namespace.point(t.geometry.coordinates);return neighborhoods.map(e=>{var a=turf_distance__default.default([e.map.lng,e.map.lat],n);(a<5&&in_bbox_helper(t.geometry.coordinates,e.boundary)||1e-5<e.radius&&a<e.radius||a<.8)&&(o.push(e.id),i.push(e.slug))}),o},in_bbox_helper=(e,a)=>{return""!==a&&void 0!==a&&(a=JSON.parse(a),a=turf__namespace.polygon([a]),turf_boolean__default.default(e,a))},nearest_neighborhood=a=>{const e=neighborhoods.map(e=>({name:e.name,neigh_dist:turf_distance__default.default([e.map.lng,e.map.lat],a)}));return e.sort(function(e,a){return e.neigh_dist-a.neigh_dist}),e.slice(0,10)},challenge_badges_lookup=()=>{const a=[];return badges$1.badges.map(e=>{"neighborhood"==e.type&&a.push(e)}),a},associate_badge=t=>{const e=challenge_badges_lookup(),o=[];return e.map(a=>{console.log(a);for(let e=0;e<t.length;e++)a.location.ID==t[e]&&o.push(a)}),o},searchCities=async(e="")=>{e="https://dev.vibemap.com/search_locations/?city="+e;const a=await axios.get(e).catch(e=>(console.log("error ",e),{error:!0,data:e}));return a.data.map(a=>{var e=cities.find(e=>e.name.includes(a.name));if(e&&map.distanceBetweenLocations(a.location,e.location)<10)return e;return neighborhoods.find(e=>e.name.toLowerCase().includes(a.name.toLowerCase())),a})},searchTags=async(e="art")=>{e=ApiUrl+"/tags/?"+e,e=await axios.get(e).catch(e=>(console.log("error ",e),{error:!0,data:e}));return console.log("tags response ",e.data),e.data},getAllBoundaries=async()=>{return(await axios.get("https://api.vibemap.com/v0.3/boundaries/?admin_level=both").catch(e=>{console.log("error ",e)})).data},getBoundary=async(e="chicago")=>{e="https://api.vibemap.com/v0.3/boundaries/?admin_level=both&slug="+e,e=await axios.get(e).catch(e=>{console.log("error ",e)});if(!e||!e.data)return null;try{return e.data.results[0]||null}catch(e){return console.log("Problem with boundary data ",e),null}},searchPlacesByName=async(e,a)=>{var t=e.point?e.point.split(",").map(parseFloat):"",t={ordering:"name",category:e.category||"",per_page:e.perPage||50,dist:0<e.distance?e.distance*constants.METERS_PER_MILE:"",point:t,search:e.search||"",vibes:e.vibes||"",zoom:e.zoom||""},e=new URLSearchParams(t).toString(),t=await axios.get(a+"/search/places/?"+e).catch(function(e){return console.log("axios error ",e.response&&e.response.statusText),[]});return t.data?t.data.results.features:[]},suggestPlacesByName=async(e,a,t=!1,o=null,i=null,n=null)=>{let r=null!==o&null!==i&t?o.toString()+"__"+i.toString():null;r=n&t?r+`__${n.toString()}km`:r;o=t?a+`/places/suggest/?name_suggest_context=${e}&name_suggest_loc=`+r:a+"/places/suggest/?name_suggest__completion="+e;console.log("HELPERS suggestPlacesByName full URL: "+o);let l;return(l=await axios.get(o).catch(function(e){return console.log("axios error ",e.response&&e.response.statusText),[]})).data?t?l.data.name_suggest_context[0].options.map(e=>e._source):l.data.name_suggest__completion[0].options.map(e=>e._source):[]},sortNeighborhoodsByVibes=(e,a)=>{if(0===a.length)return e;var t=vibes.getRelatedVibes(a);const i=[...new Set([...a,...t])],o=e.map(e=>{const a=e.vibes||e.acf.vibes,t=a.map(({slug:e})=>e);var o=i.filter(e=>t.includes(e)).length;return{...e,vibeIntersection:o}}),n=o.sort((e,a)=>a.vibeIntersection-e.vibeIntersection);return n.map(e=>{const{vibeIntersection:a,...t}=e;return t})};exports.associate_badge=associate_badge,exports.challenge_badges_lookup=challenge_badges_lookup,exports.decodePlaces=decodePlaces,exports.displayHours=displayHours,exports.encodeCardIndex=encodeCardIndex,exports.fetchEvents=fetchEvents,exports.fetchPlacePicks=fetchPlacePicks,exports.fetchPlacesDetails=fetchPlacesDetails,exports.fetchPlacesFromIds=fetchPlacesFromIds,exports.fetchPlacesFromSearch=fetchPlacesFromSearch,exports.filterList=filterList,exports.formatDateTime=formatDateTime,exports.formatPlaces=formatPlaces,exports.geLocationFromCity=geLocationFromCity,exports.getAPIDomain=getAPIDomain,exports.getAPIParams=getAPIParams,exports.getAllBoundaries=getAllBoundaries,exports.getBoundary=getBoundary,exports.getCardOptions=getCardOptions,exports.getCategoryMatch=getCategoryMatch,exports.getEventOptions=getEventOptions,exports.getFullLink=getFullLink,exports.getMax=getMax,exports.getMin=getMin,exports.getRandomItem=getRandomItem,exports.getRecommendedVibes=getRecommendedVibes,exports.getTimeOfDay=getTimeOfDay,exports.getTopCategories=getTopCategories,exports.getTopVibes=getTopVibes,exports.getWaveFromVibe=getWaveFromVibe,exports.graphToEvents=graphToEvents,exports.groupsToEvents=groupsToEvents,exports.in_bbox_helper=in_bbox_helper,exports.in_jls=in_jls,exports.in_neighborhood=in_neighborhood,exports.isClosedToday=isClosedToday,exports.isOpen=isOpen,exports.matchLists=matchLists,exports.nearest_neighborhood=nearest_neighborhood,exports.nearest_places=nearest_places,exports.normalize=normalize,exports.normalize_all=normalize_all,exports.parseDateTime=parseDateTime,exports.rankVibes=rankVibes,exports.reducePlaceProperties=reducePlaceProperties,exports.scaleDensityArea=scaleDensityArea,exports.scaleDensityBonus=scaleDensityBonus,exports.scaleIconSize=scaleIconSize,exports.scaleMarker=scaleMarker,exports.scaleScore=scaleScore,exports.scaleSelectedMarker=scaleSelectedMarker,exports.scorePlaces=scorePlaces,exports.searchCities=searchCities,exports.searchPlacesByName=searchPlacesByName,exports.searchTags=searchTags,exports.shuffleTopPicks=shuffleTopPicks,exports.sortByArray=sortByArray,exports.sortByKey=sortByKey,exports.sortByPopularity=sortByPopularity,exports.sortNeighborhoodsByVibes=sortNeighborhoodsByVibes,exports.suggestPlacesByName=suggestPlacesByName,exports.toTitleCase=toTitleCase,exports.validate_check_in=validate_check_in,exports.vibesFromPlaces=vibesFromPlaces;
//# sourceMappingURL=helpers.js.map
