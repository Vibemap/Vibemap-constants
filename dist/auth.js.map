{"version":3,"file":"auth.js","sources":["../utils/auth.js"],"sourcesContent":["import Axios from \"axios\"\n\n// TODO: switch between staging and production apis\nconst API_ROOT = 'https://staging.vibemap.xyz/api'\n\nconst axiosInstance = Axios.create({\n  timeout: 15000,\n  headers: {'Content-Type': 'application/json'}\n});\n\n//Interceptor and RefreshToken function is a work in progress.\n//I need to find a way to return the new accessToken and refreshToken to the client\n//to update the values in there.\naxiosInstance.interceptors.response.use(\n  (response) => {\n    console.log(\"Response is:\", response);\n    return response;\n  },\n  (error) => {\n    console.log(\"Status: \", error.response.status,\"Error is: \", error);;\n    const originalRequest = error.config;\n    if (error.response.status === 401) {\n      originalRequest._retry = true;\n\n      return refreshToken(originalRequest);\n    }\n    return Promise.reject(error);\n  }\n);\n\n//Call this method when the app is initialize to set the refreshToken\n//Note: If there is a better or correct way to have/set a global value do it.\n//Maybe create a class?\nexport const setRefreshToken = (token) => {\n  refreshToken = token;\n}\n\nexport const register = async (data, apiRoot = API_ROOT) => {\n  const endpoint = '/auth/register'\n  const config = {\n    method: 'post',\n    url: apiRoot + endpoint,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    data : data\n  }\n\n  console.log('Register with: ', data, config)\n  axiosInstance(config)\n    .then(function (response) {\n      console.log(JSON.stringify(response.data))\n      axiosInstance.defaults.headers['Authorization'] = `Bearer ${response.data.accessToken}`;\n      return response\n    })\n    .catch(function (error) {\n      console.log('Problem with request: ', error);\n    });\n\n}\n\nexport const logIn = async (data, apiRoot = API_ROOT) => {\n  const endpoint = '/auth/login'\n  const config = {\n    method: 'post',\n    url: apiRoot + endpoint,\n    data : JSON.stringify(data)\n  }\n\n  axiosInstance(config)\n    .then(function (response) {\n      console.log(JSON.stringify(response.data))\n      axiosInstance.defaults.headers['Authorization'] = `Bearer ${response.data.accessToken}`;\n      return {response: response , error: undefined}\n    })\n    .catch(function (error) {\n      console.log('Problem with request: ', error);\n      return {response: undefined , error: error}\n    });\n\n}\n\nexport const resetPassword = async (data, apiRoot = API_ROOT) => {\n  const endpoint = apiRoot === API_ROOT ? '/auth/password-reset' : '/auth/reset-password'\n  const config = {\n    method: 'post',\n    url: apiRoot + endpoint,\n    data : JSON.stringify(data),\n  }\n\n  axiosInstance(config)\n    .then(function (response) {\n      console.log(JSON.stringify(response.data))\n      return {response: response , error: undefined}\n    })\n    .catch(function (error) {\n      console.log('Problem with request: ', error);\n      return {response: undefined , error: error}\n    });\n\n}\n\nexport const changePassword = async (data, token, apiRoot = API_ROOT) => {\n  const endpoint = '/auth/change-password'\n  const config = {\n    method: 'post',\n    url: apiRoot + endpoint,\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${token}`\n    },\n    data : JSON.stringify(data)\n  }\n\n  axiosInstance(config)\n    .then(function (response) {\n      console.log(JSON.stringify(response.data))\n      return {response: response , error: undefined}\n    })\n    .catch(function (error) {\n      console.log('Problem with request: ', error);\n      return {response: undefined , error: error}\n    });\n\n}\n\nexport const logOut = async (data, apiRoot = API_ROOT) => {\n  const endpoint = '/auth/logout'\n  const config = {\n    method: 'post',\n    url: apiRoot + endpoint,\n    data : JSON.stringify(data)\n  }\n\n  axiosInstance(config)\n    .then(function (response) {\n      console.log(JSON.stringify(response.data))\n      return {response: response , error: undefined}\n    })\n    .catch(function (error) {\n      console.log('Problem with request: ', error);\n      return {response: undefined , error: error}\n    });\n\n}\n\nexport const refreshToken = async (\n    originalRequest,\n    data = {'refreshToken': refreshToken},\n    apiRoot = API_ROOT\n  ) => {\n  const endpoint = '/auth/logout'\n  const config = {\n    method: 'post',\n    url: apiRoot + endpoint,\n    data : JSON.stringify(data)\n  }\n\n  axiosInstance(config)\n    .then(function (response) {\n      console.log(JSON.stringify(response.data))\n      axiosInstance.defaults.headers['Authorization'] = `Bearer ${response.data.accessToken}`;\n      originalRequest.headers['Authorization'] =  `Bearer ${response.data.accessToken}`;\n      return axiosInstance(originalRequest);\n    })\n    .catch(function (error) {\n      console.log('Problem with request: ', error);\n      return {response: undefined , error: error}\n    });\n\n}\n\nexport const oauthLogin = async (\n  {\n    provider,\n    token,\n    googleClientID,\n    appleName,\n    appleLastName,\n  },\n  apiRoot = API_ROOT\n) => {\n  const endpoint = '/auth/oauth'\n  const config = {\n    method: 'post',\n    url: apiRoot + endpoint,\n    data: JSON.stringify({\n      provider,\n      token,\n      googleClientID,\n      appleName,\n      appleLastName,\n    }),\n  }\n\n  return axiosInstance(config)\n}\n"],"names":["API_ROOT","axiosInstance","Axios","create","timeout","headers","Content-Type","setRefreshToken","interceptors","response","use","console","log","error","status","originalRequest","config","_retry","refreshToken","Promise","reject","token","register","async","data","apiRoot","method","url","then","JSON","stringify","defaults","accessToken","catch","logIn","undefined","resetPassword","changePassword","Authorization","logOut","oauthLogin","provider","googleClientID","appleName","appleLastName"],"mappings":"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"}